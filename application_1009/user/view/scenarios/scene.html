{extend name="public/base" /}
{block name="body"}

<style type="text/css">
.main-box .main-box-body {
    padding: 0 20px 20px 0px;
}
.robot-limit {
    text-align: left;
    font-size: 12px;
    color: #999;
    margin-top: 10px;
}
.robot-item.active {
    background-color: #fff;
    border-color: #1f8cec;
}
.robot-item .control-icon {
    position: absolute;
    display: none;
    top: 5px;
    right: 5px;
    border-radius: 3px;
    width: auto;
    z-index: 100;
    background-color: #dfeaf9;
}
.robot-item .control-icon .anticon:hover {
    color: #1f8cec;
}
.robot-item .control-icon .anticon {
    cursor: pointer;
    margin: 5px;
    font-size: 14px;
	color:#c1c1c1;
}
.robot-item>.item-name {
    font-size: 14px;
    display: inline-block;
    margin-bottom: 10px;
    word-break: break-all;
    color: rgba(0,0,0,.75);
    word-wrap: break-word;
    font-weight: 500;
}
<!-- .btn-default, .wizard-cancel, .wizard-back { -->
    <!-- background-color: #ffffff; -->
    <!-- border-color: #03a9f4; -->
    <!-- color: #03a9f4; -->
    <!-- border-bottom: 0px solid; -->
    <!-- border: 1px solid; -->
<!-- } -->
.robot-item .word {
    font-size: 12px;
}
 .robot-item:hover .control-icon {
    display: inline-block;
}
 .robot-item {
    cursor: pointer;
    display: -ms-flexbox;
    display: flex;
    -ms-flex-direction: column;
    flex-direction: column;
    position: relative;
    padding: 10px;
    border-radius: 3px;
    background: #f8f9fb;
    border: 1px solid #f8f9fb;
    text-align: left;
	  margin-bottom: 8px;
}

.robot-list{
 margin-top: 10px;
}
.spin-container {
    position: relative;
    height: 100%;
		margin-top: 5px;
		margin-bottom: 10px;
}
.main-box{
	   background: #e7ebee;
}
.main-box-header{
	background-color: #ffffff;
}
.main-box-body{
	  background-color: #ffffff;
    margin-top: 5px;
}
.container-fluid{
	padding-left: 0px;
	padding-right: 0px;
	background-color: #f3f3f3;
}
.right-robot-list{
	    padding-right: 0px;
			background-color: #ffffff;
			width: 83.66666667%;
      float: right;
}
.nav-tabs {
    border-bottom: 1px solid #ddd;
	  background: #ffffff;
}
.nav-tabs>li.active>a, .nav-tabs>li.active>a:focus, .nav-tabs>li.active>a:hover {
    color: #03a9f4;
    cursor: default;
    background-color: #fff;
    border-bottom: 2px solid #03a9f4;
    border-bottom-color: #03a9f4;
		border-top: 0px solid #03a9f4;
}
.left-robot-list {
    background-color: #ffffff;
		width: 15.666667%;
		overflow-y: auto;
		height: calc(100vh - 150px);
}
.btntop{
	    margin-top: 5px;
}
.ltbtn{
    margin-right: 5px;
    width: 45%;
    text-align: center;
    padding: 6px 6px;
}
.intnet-tag-tips {
    margin-bottom: 10px;
}
.user-level {
    font-size: 14px;
    margin-top: 20px;
    color: rgba(0,0,1,.75);
    margin-bottom: 10px;
}
.user-level .user-level-eidt {
    color: #108ee9;
    margin-left: 20px;
    cursor: pointer;
}
.text-left{
	  line-height: 34px;
}
.table > thead>tr>th {
    font-size: 14px;
    font-weight: 400;
    background-color: rgba(223,234,249,.4);
}

.btn-primary.focus, .btn-primary:focus {
    color: #fff;
    background-color: #03a9f4;
     border-color: #03a9f4;
}

.btn-default.active.focus, .btn-default.active:focus, .btn-default.active:hover, .btn-default:active.focus, .btn-default:active:focus, .btn-default:active:hover, .open>.dropdown-toggle.btn-default.focus, .open>.dropdown-toggle.btn-default:focus, .open>.dropdown-toggle.btn-default:hover {
    color: #03a9f4;
    background-color: initial;
    border-color: #03a9f4;
}
.btn-default.focus, .btn-default:focus {
    color: #03a9f4;
   background-color: initial;
    border-color: #03a9f4;
}
.btn-default:hover {
    color: #03a9f4;
    background-color: initial;
    border-color: #03a9f4;
}

.btn-primary.active, .btn-primary:active, .open>.dropdown-toggle.btn-primary {
    color: #fff;
    background-color: #03a9f4;
    border-color: #03a9f4;
}
.btn-primary:hover {
    color: #fff;
    background-color: #03a9f4;
    border-color: #03a9f4;
}
.form-group {
	margin-bottom: 6px;
}
.textwidth{
		width:195px;
}

</style>

<style type="text/css">
	
.create-modal-body {
    overflow-y: auto;
    padding: 15px 30px;
}	

.add-modal-wrap {
    padding: 0 14px;
}
.add-modal-tips {
    display: -ms-flexbox;
    display: flex;
    font-size: 14px;
    -ms-flex-pack: justify;
    justify-content: space-between;
    margin-bottom: 6px;
    -ms-flex-align: center;
    align-items: center;
}
.modal-rules-wrap {
    padding-bottom: 20px;
    border-bottom: 1px solid rgba(0,0,0,.09);
}
.modal-result {
    font-size: 14px;
    margin-top: 17px;
}
.modal-result p {
    color: rgba(0,0,1,.75);
}
.rule-item{
	margin-top: 5px;
}

.rule-item .rule-item-delete {
    color: #1f8cec;
    vertical-align: middle;
    cursor: pointer;
}
.rule-item .itmr{
	margin-right: 7px;
} 
#conditionlist > .rule-item > .mainwidth{
	min-width:150px;
}
#conditionlist > .rule-item > .secwidth{
	width:80px;
}
#conditionlist > .rule-item > .itnuwidth{
	width:68px;
}
#newRule > .modal-dialog{
    max-height: calc(100% - 100px);
}
.dropup > .btn-default:hover, .btn-default:active, .btn-default.active, .open .dropdown-toggle.btn-default {
    background-color: #fff;
    border: 1px solid #ccc;
}
.dropdown-menu>li>a {
    color: #191717;
    font-size: 1em;
    line-height: 1.7;
    padding-left: 35px;
    transition: border-color 0.1s ease-in-out 0s,background-color 0.1s ease-in-out 0s;
    padding-top: 5px;
}
#conditionlist > .rule-item > #disabled2select >  .itnuwidth{
	width:173px;
}
.left-process-list {
    background-color: #ffffff;
    width: 15.666667%;
    overflow-y: auto;
		float: left;
    height: calc(100vh - 210px);
}
.right-process-list {
    padding-right: 0px;
    background-color: #ffffff;
    width: 83.66666667%;
    float: right;
}
.talk-list-item {
    margin: 10px 10px 10px 0;
    cursor: pointer;
    display: -ms-flexbox;
    display: flex;
    -ms-flex-direction: column;
    flex-direction: column;
    position: relative;
    padding: 30px 10px;
    border-radius: 3px;
    background: #f8f9fb;
    border: 1px solid #f8f9fb;
}
.talk-list-item .control-icon {
    position: absolute;
    display: none;
    top: 5px;
    right: 5px;
    border-radius: 3px;
    width: auto;
    z-index: 100;
    background-color: #dfeaf9;
}
.talk-list-item:hover .control-icon {
    display: inline-block;
}
.talk-list-item.active {
    background-color: #fff;
    border-color: #1f8cec;
}
.talk-list-item .control-icon .anticon {
    cursor: pointer;
    margin: 5px;
    font-size: 14px;
    color: #c1c1c1;
}

.ttfw{
	width: 250px;
}
.answer-input-item{
	margin-top: 10px;
}
.ktextarea{
	  width: 190px;
    float: left;
    margin-right: 10px;
		resize: vertical;
}
.icon-plus .icon-delete{
    cursor: pointer;
		color: rgba(0,0,0,.65);
}
.icon-plus .icon-delete:hover {
    color: #f04134;
}
#contentlist{
	  overflow-y: auto;
    max-height: 222px;
}
</style>

<!-- <link rel="stylesheet" type="text/css" href="./iconfont.css">
 -->
<div class="row">
<div class="col-lg-12">
	
	<div class="main-box clearfix">	
	
		<header class="main-box-header clearfix">
		  <div class="pull-left">
			  <h1>话术管理</h1>
		  </div>
		</header>
		
		 
		<div class="main-box-body clearfix">
			  <div class="container-fluid">
					
					<div class="left-robot-list col-xs-3 col-md-2">
						<div class="btntop">
							<button type="button" onclick="newScenariosModal(0);" class="btn btn-primary ltbtn">新建话术</button>
							<button type="button" class="btn btn-default ltbtn" style="margin-right: 0px;">复制话术</button>
						</div>
						<div class="robot-limit">
							 <span>{$num|default="0"}/100</span> 
							 <span class="glyphicon glyphicon-question-sign" aria-hidden="true" 
							 data-toggle="tooltip" data-placement="top" title="数值为‘已有话术/可添加话术总数’，若需扩容，请联系你的服务商。"></span>
						</div>
						
						<div class="robot-list">
							
							{volist name="scenarioslist" id="vo" key="k"}
		
								<div class="robot-item" id="taskItem{$vo.id}" title="{$vo.name}" onclick="getscenarios(this,{$vo.id});">
									<input id="list{$k}" type="hidden" class="Idlist" value="{$vo.id}" />
									<div class="control-icon">
										<span class="anticon glyphicon glyphicon-edit" onclick="newScenariosModal({$vo.id});" aria-hidden="true"></span>
										<span class="anticon glyphicon glyphicon-trash" onclick="delScenarios('{$vo.id}');" aria-hidden="true"></span>
									</div>
									<span class="item-name">
										<span class="glyphicon glyphicon-file" aria-hidden="true"></span>
										{$vo.name}
									</span>
									<div class="word">
										<p>行业：{switch name="$vo.type"}
													{case value="0"}请选择行业{/case}
													{case value="1"}金融{/case}
													{case value="2"}贷款{/case}
													{case value="3"}房产{/case}
													{case value="4"}装修{/case}
													{case value="5"}汽车{/case}
													{case value="6"}教育{/case}
													
													{default /}其他
												{/switch}</p>
									
									  <div>自动打断	：
											{switch name="$vo.break"}
												{case value="1"}否{/case}
												{default /}是
											{/switch}
									  </div> 
										
										{eq name="examine" value="1"}
									 	<div>审核结果：		
											{if condition="$super == 1"} 
												{switch name="$vo.auditing"}
													{case value="2"}
													 <a href="javascript:void(0);" onclick="showExamine({$vo.id});">审核</a>
													{/case}
													{default /}
													 无
												{/switch}
											
											{else /}
											
														{switch name="$vo.auditing"}
															{case value="1"}
																<a href="javascript:void(0);"  onclick="submitAuditing({$vo.id});">提交审核</a>
															{/case}
															{case value="2"}
																审核中
															{/case}
															{case value="3"}
																不通过
															{/case}
															{default /}
															审核通过
														{/switch}

											
											{/if}
										</div>
										{/eq}
										
										<div>更新时间：{$vo.update_time}</div> 
									</div>
								</div>
								
							{/volist}

						</div>
						
					</div>
					
					<div class="right-robot-list col-xs-15 col-md-10">
						
						<!-- 当前话术的ID -->
						<input type="hidden" name="nowsceneID" id="nowsceneID" value="" />
						
						<!-- 当前流程的ID -->
						<input type="hidden" name="nowProcessId" id="nowProcessId" value="" />
						
						<div class="spin-container">
							 <!-- Nav tabs -->
							 <ul class="nav nav-tabs" id="myTab" role="tablist" style="margin-bottom: 20px;">
								 
							 	<li role="presentation" class="active">
									<a href="#process" aria-controls="process" role="tab" data-toggle="tab">流程</a>
								</li>
							 	<li role="presentation">
									<a href="#knowledgeBase" aria-controls="knowledgeBase" role="tab" data-toggle="tab">知识库</a>
								</li>
								
								<li role="presentation">
									<a href="#intentionLabel" aria-controls="intentionLabel" role="tab" data-toggle="tab">意向标签</a>
								</li>
								<li role="presentation">
									<a href="#problemLearning" aria-controls="problemLearning" role="tab" data-toggle="tab">问题学习</a>
								</li>
						
							 </ul>
							 
							 <!-- Tab panes -->
							 <div class="tab-content">
								 
							 	<div role="tabpanel" class="tab-pane active" id="process">
									 <div class="row" style="padding-left: 10px;">
										 
										  <div class="left-process-list" style="border-right: 1px solid #ccc;">
											 
													 <div class="btntop">
														 <button type="button" class="btn btn-primary" style="width: 94%;" onclick="newflowModal(0);">
													      <i class="fa fa-plus-circle fa-lg" style="margin-right: 10px;"></i>添加
													   </button>
													 </div>
													 
													 <div class="flowlist">
														 
												
														 <div class="talk-list-item active" onclick="getflow(this);">
																
																<div class="control-icon">
																	<span class="anticon glyphicon glyphicon-edit" aria-hidden="true"></span>
																	<span class="anticon glyphicon glyphicon-trash" aria-hidden="true"></span>
																</div>
																
																<div class="talklist-item-content"><div>了解情况</div></div>
																
															</div>
															
														
													 </div>
													

											</div>
											
											<div class="right-process-list">
												
												
												<section class="navbar navbar-default main-box-header clearfix">
													
													<div class="row">
														<div class="col-sm-6">
															<div class="pull-left">
																<input type="search" class="form-control" onkeyup="getkeywords(this);" placeholder="请输入关键字" aria-label="...">
															</div>
														</div>
														
														<div class="col-sm-6">
															<div class="pull-right">
																<button type="button" onclick="showThinks(0);" class="btn btn-primary">添 加</button>
															</div>
														</div>
													</div>
													
												</section>
												
												
													<div style="background-color:#ffffff;"> 
													
													   <table class="table table-bordered table-hover">
																<thead>
																		<tr>
																			<th class="text-center">判断顺序</th>
																			<th class="text-center">规则名称</th>
																		
																			<th class="text-center">客户意向标签</th>
																			
																			<th class="text-center">操作</th> 
																		</tr>
																</thead>
																<tbody >
																
																	<tr class="itemId63" alt="63">
																		<td class="text-center">0</td>
																		<td class="text-center">通话状态 = 无人接听停机</td>
																		<td class="text-center">E类(拨打失败)</td>
																		<td class="text-center">
																			<a href="javascript:void(0);" onclick="editLabel(63);">编辑</a>&nbsp;&nbsp;
																			<a href="javascript:void(0);" onclick="delLabel(63);">删除</a>
																		</td>
																	</tr>
																</tbody>
																
														 </table>
													
													</div>

											</div>

                      <div style="clear: both;"></div>
									 </div>
								
								</div>
								
								<div role="tabpanel" class="tab-pane" id="knowledgeBase">
									  	
									  	<section class="navbar navbar-default main-box-header clearfix">
												
												<div class="row">
													<div class="col-sm-6">
														<div class="pull-left">
															<input type="search" class="form-control" onkeyup="getkeyword(this);" placeholder="请输入关键字" aria-label="...">
														</div>
													</div>
													
													<div class="col-sm-6">
														<div class="pull-right">
															<button type="button" onclick="showThink(0);" class="btn btn-primary">添 加</button>
														</div>
													</div>
												</div>
												 
									  	</section>
									  	
									  	<table class="table table-bordered table-hover">
									  			<thead>
									  					<tr>
									  						<th class="text-center">标题</th>
									  						<th class="text-center">问法</th>
									  						<th class="text-center">关键词</th>
									  						<th class="text-center" style="width: 139px;">更新时间</th>
									  						<th class="text-center">操作</th> 
									  					</tr>
									  			</thead>
									  			<tbody id="knowledgelist">
									  			
									  			</tbody>
									  	</table>
									  		
									  	<div id="knowledgepage"></div>
									  	
								</div>	
							
								<div role="tabpanel" class="tab-pane" id="intentionLabel">
									
									<div class="row intnet-tag-tips">
										<div class="col-sm-5 text-left">
											<!-- <span>可拖动调整判断顺序</span> -->
										</div>
										<div class="col-sm-7">
										   <div style="float:right">
													<button type="button" onclick="recovery();" class="btn btn-primary">
														恢复默认配置
													</button>
													<button type="button" onclick="createNew();" class="btn btn-primary" style="margin-left: 10px;">
														添加规则
													</button>
										   </div>
										</div>
									</div>
			
										
									<table class="table table-bordered table-hover">
											<thead>
													<tr>
														<th class="text-center">判断顺序</th>
														<th class="text-center">规则名称</th>
													
														<th class="text-center">客户意向标签</th>
														
														<th class="text-center">操作</th> 
													</tr>
											</thead>
											<tbody id="intentionlist">
											
											</tbody>
									</table>
							
									<div id="intentionpage"></div>
										<div class="user-level">
											<p>
												<span>以上规则均不满足时，将客户意向标签设置为<span id="defaultlevel">C级(明确拒绝)</span></span>
												<input type="hidden" id="dflevelNum" value="" />
												<span class="user-level-eidt" id="defaulttype" onclick="showdefault(this);">编辑</span>
											</p>
										</div>
										
										
								</div>	
										
								<div role="tabpanel" class="tab-pane" id="problemLearning">
									
									<section class="navbar navbar-default main-box-header clearfix">
										<div class="pull-left">
											<div class="btn-group" role="group" aria-label="...">
												<button type="button" id="dflearn" data-type="" onclick="getLearning(this);" class="btn btn-default">全部</button>
												<button type="button" data-type="0" onclick="getLearning(this);" class="btn btn-default">待学习</button>
												<button type="button" data-type="1" onclick="getLearning(this);" class="btn btn-default">已学习</button>
												<button type="button" data-type="2" onclick="getLearning(this);" class="btn btn-default">忽略</button>
											</div>
										</div>  
									</section>
									
									<table class="table table-bordered table-hover">
											<thead>
													<tr>
														<th class="text-center">待学习的内容</th>
														<th class="text-center">来源</th>
														<th class="text-center">学习状态</th>
														<th class="text-center" style="width: 139px;">记录时间</th>
														<th class="text-center">操作</th> 
													</tr>
											</thead>
											<tbody id="tablelearninglist">
											
											</tbody>
									</table>
								
									<div class="row">
										<div class="col-sm-4"></div>
										<div class="col-sm-8"></div>
									</div>
											
									<div id="modalbody"></div>
									
								</div>
								
								
							</div>
									
							 
						</div>
						
						
					</div>
					
				</div>
		</div>
					
	</div>					
    
</div>

 <script type="text/javascript">
	 
	 //获取流程场景
	 function getflow(obj){
	 	
		var val = $(obj).attr("dataId");

		$("#nowProcessId").val(val);

	 	$(obj).addClass("active");
	 	$(obj).siblings(".active").removeClass("active");
	 	
	 } 
	 
	 
	 //知识库的搜索
	 function getkeyword(obj){
		 
		 var val = $(obj).val();
     //console.log(val);
		 knowledgekw = val;
		 getKnowledgeList(1);

	 }
	 
	 
	 
	 //删除意向标签
	 
	 function delKnowledge(id){
		 
	
  	var r=confirm('确认删除?');
			if (!r) 
					return; 
	
		$.post("{:url('delKnowledge')}",{'id':id},function(data){
				if(data){
					alert(data);
				}else{
					getKnowledgeList(1);
				}
		}); 
		
				
	 }
	 

 </script>
 
 <script type="text/javascript">
	 
		$(function () {
	 	 
			$('#myTab a').click(function (e) {
				e.preventDefault();
				var type = $(this).attr('aria-controls');
				console.log(type);
        
				if (type == 'intentionLabel'){
					getLabelList(1);
				}
				else if(type == "knowledgeBase"){
					
					getKnowledgeList(1);

				}
				
			});
			
					var numArr = new Array();
					$('.Idlist').each(function(){
							numArr.push($(this).val());//添加至数组
					});
				 
				 if(numArr.length > 0){
						 
							$("#taskItem"+numArr[0]).addClass("active");
							$("#taskItem"+numArr[0]).siblings(".active").removeClass("active");
							
							$("#nowsceneID").val(numArr[0]);
							
							// $("#dflearn").css({ 'color': "#fffff", 'background-color': "#03a9f4" });	 
							$("#dflearn").removeClass("btn-default");	 
							$("#dflearn").addClass("btn-primary");	 
							$("#dflearn").siblings(".btn").addClass("btn-default");
							
							searchdata(1,""); //获取学习的数据
							
							//获取流程节点列表
							getNoteList();
					
					 }
				

		});
	 
		//获取 意向标签 intentionLabel列表
		function getLabelList(page){	
			
			var sceneId = $("#nowsceneID").val();
			//取默认等级
			backdefault(sceneId);
			 
			var url = "{:url('getLabelList')}";	
			$.ajax({
							url : url,
							dataType : "json", 
							type : "post",
							data : {'page':page,'sceneId':sceneId},
							success: function(data){
								var total = data.data.total;
								var Nowpage = data.data.Nowpage;
								var page = data.data.page;
								var Nowpage = parseInt(Nowpage);
								
								var data = data.data.list;
								 if(data.length > 0){
 
											$("#intentionlist").find("tr").remove();
											
											for(var i=0;i<data.length;i++){
												
											
												var id = data[i].id;
												var name = data[i].name;
												var level = data[i].level;
												var type = data[i].type;
												var rule = data[i].rule;
												var sort = data[i].sort;

												var status = data[i].status;
												var create_time = data[i].create_time;
												var update_time = data[i].update_time;
 
										
	
 
												var string = '<tr class="itemId'+id+'" alt="'+id+'">'
													+'<td class="text-center">'+(i+1)+'</td>' 
													+'<td class="text-center">'+name+'</td>'
													+'<td class="text-center">'+level+'</td>'
													+'<td class="text-center">';

													string += '<a href="javascript:void(0);" onclick="editLabel('+id+');">编辑</a>&nbsp;&nbsp;'
													+'<a href="javascript:void(0);" onclick="delLabel('+id+');">删除</a>'
 
													+'</td>';

											 string += '</tr>';
											 
												$("#intentionlist").append(string); 
	
											}
											
											var prepage = Nowpage-1;
											var nextpage = Nowpage+1;
										 
											var str = '<div class="row">'
											+'<div class="col-sm-3 text-left">'
														
											+'<table class="table table-bordered table-hover" style="margin-bottom: 0px; ">'
											+'<tbody><tr>'
											+'<td class="text-center">总数：'
											+'</td>'
											+'<td class="text-center">'+total+'&nbsp;'
											+'</td>'
																	 
											+'</tr> '
											+'</tbody></table>'                                     
				
											+'</div>'
											+'<div class="col-sm-9 text-right">'
											+'<ul class="pagination">';
										 
											if(Nowpage == 1){
												str += '<li id="prevbtn" class="disabled"><span>«</span></li> ';
											}else{
												str += '<li><a href="javascript:void(0);" onclick="getLabelList('+prepage+');"><span>«</span></a></li> ';
											}
											
											if(page > 10){
											
												if(Nowpage < 7){
													for(var i=0;i<page;i++){
														var nownum = i+1;
														if(nownum < 9){
															 if(nownum == Nowpage){
																 str += '<li class="active"><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+' </a></li> ';  
															 }else{
																 str += '<li><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+' </a></li> ';  
															 }
														}
														
														if(nownum == 9 && nownum != Nowpage){
															 str += '<li class="disabled"><span>...</span></li>';  
														}else if(nownum == 9){
															str += '<li class="active"><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+'</a></li> ';  
														}
													
															if(nownum > (page-2)){
																if(nownum == Nowpage){
																	 str += '<li class="active"><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+' </a></li> ';  
																 }else{
																	 str += '<li><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+' </a></li> ';  
																 }
															}
	
													 }
												}else if(Nowpage > 6 && Nowpage < (page-6)){
													for(var i=0;i<page;i++){
														var nownum = i+1;
														var Nowpage = parseInt(Nowpage);
														if(nownum < 3){
															str += '<li><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+' </a></li> '; 
														}
														
														if((nownum > Nowpage-5) && (nownum < Nowpage+5)){
													
																		 if(nownum == (Nowpage-4)){
																				str += '<li class="disabled"><span>...</span></li>';
																		 }   
																		
																			 if(nownum > (Nowpage-4) && nownum < Nowpage){
																				 str += '<li><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+'</a></li>'; 
																			 }  
																		 
																			 if(nownum == Nowpage){
																			 str += '<li class="active"><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+'</a></li>';  
																			 } 
																		 
																			 if(nownum < (Nowpage + 4) && nownum > Nowpage){
																				str += '<li><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+'</a></li>'; 
																			 }  
																	
																			 if(nownum == (Nowpage + 4)){
																			
																			 str += '<li class="disabled"><span>...</span></li>';
																			 }   
														 }
														 
													 if(nownum > (page-2)){
														 var Nowpage = parseInt(Nowpage);
														 if(nownum == Nowpage){
																	 str += '<li class="active"><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+'</a></li>';
															 }else{
																	str += '<li><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+'</a></li> ';
															 }   
													 
															}     
	
													 }
												}else{
													
													for(var i=0;i<page;i++){
														var nownum = i+1;
														if(nownum<3){
															str += '<li><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+' </a></li>';  
														}
													
														if(nownum == (page-10) && nownum != Nowpage){
															str += '<li class="disabled"><span>...</span></li>';   
														}else if(nownum == (page-10) && nownum == Nowpage){
															str += '<li class="active"><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+'</a></li>';   
														}
														
														if(nownum > (page-10)){
															if(nownum == Nowpage){
																str += '<li class="active"><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+'</a></li> ';   
															}else{
																str += '<li ><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+'</a></li>';   
															}
														}
														
														
													}
										 
														
												}
											}else{
												 for(var i=0;i<page;i++){
													 var nownum = i+1;
													 if(nownum == Nowpage){
														 str += '<li class="active"><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+' </a></li> ';  
													 }else{
														 str += '<li><a href="javascript:void(0);" onclick="getLabelList('+nownum+');">'+nownum+' </a></li> ';  
													 }
												 }
											}
											
						
									 
											if(Nowpage == page){
												str += '<li id="prevbtn" class="disabled"><span>»</span></li> ';
											}else{
												str += '<li><a href="javascript:void(0);" onclick="getLabelList('+nextpage+');"><span>»</span></a></li>';
											}
										
											str += '</ul>'
											+'</div>'
											+'</div>'
										 
											$("#intentionpage").find("div").remove();
											$("#intentionpage").append(str); 
											
										 } else{
											 
												$("#intentionpage").find("div").remove();
 
												$("#intentionlist").find("tr").remove();
											// 	alert('没有数据。');
										 }
							},
							error : function() {
								//alert('获取页面列表失败。');
							}
				});
			
			
			 
	 }
	   
		 //获取知识库列表
		 var knowledgekw="";
		 function getKnowledgeList(page){
			 
				var sceneId = $("#nowsceneID").val();
				var nowProcessId = $("#nowProcessId").val();
			
				var url = "{:url('getKnowledgeList')}";	
				$.ajax({
								url : url,
								dataType : "json", 
								type : "post",
								data : {'page':page,'sceneId':sceneId,"processId":nowProcessId,"keyword":knowledgekw},
								success: function(data){
									
									var total = data.data.total;
									var Nowpage = data.data.Nowpage;
									var page = data.data.page;
									var Nowpage = parseInt(Nowpage);
									
									var data = data.data.list;

									
									 if(data.length > 0){
		
												$("#knowledgelist").find("tr").remove();
												
												for(var i=0;i<data.length;i++){
													
												
													var id = data[i].id;
													var name = data[i].name;
													var keyword = data[i].keyword;
													var breaks = data[i].break;
													var type = data[i].type;
													var action = data[i].action;
	 
													var action_id = data[i].action_id;
													var intention = data[i].intention;
													var last_time = data[i].last_time;
		                      var knum = data[i].knum;
													var content = data[i].content;
													
											
													var string = '<tr class="itemId'+id+'" alt="'+id+'">'
														+'<td class="text-center">'+name+'</td>' 
														+'<td class="text-center">'+keyword+'</td>'
														+'<td class="text-center">'+knum+'</td>'
														+'<td class="text-center">'+last_time+'</td>'
														+'<td class="text-center">';
	 
														string += '<a href="javascript:void(0);" onclick="showThink('+id+');">编辑</a>&nbsp;&nbsp;'
														+'<a href="javascript:void(0);" onclick="delKnowledge('+id+');">删除</a>&nbsp;&nbsp;'
														+'<a href="javascript:void(0);" onclick="showSound('+id+');">录音</a>'
														+'</td>';
	 
												 string += '</tr>';
												 
													$("#knowledgelist").append(string); 
		
												}
												
												var prepage = Nowpage-1;
												var nextpage = Nowpage+1;
											 
												var str = '<div class="row">'
												+'<div class="col-sm-3 text-left">'
															
												+'<table class="table table-bordered table-hover" style="margin-bottom: 0px; ">'
												+'<tbody><tr>'
												+'<td class="text-center">总数：'
												+'</td>'
												+'<td class="text-center">'+total+'&nbsp;'
												+'</td>'
																		 
												+'</tr> '
												+'</tbody></table>'                                     
					
												+'</div>'
												+'<div class="col-sm-9 text-right">'
												+'<ul class="pagination">';
											 
												if(Nowpage == 1){
													str += '<li id="prevbtn" class="disabled"><span>«</span></li> ';
												}else{
													str += '<li><a href="javascript:void(0);" onclick="getKnowledgeList('+prepage+');"><span>«</span></a></li> ';
												}
												
												if(page > 10){
												
													if(Nowpage < 7){
														for(var i=0;i<page;i++){
															var nownum = i+1;
															if(nownum < 9){
																 if(nownum == Nowpage){
																	 str += '<li class="active"><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+' </a></li> ';  
																 }else{
																	 str += '<li><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+' </a></li> ';  
																 }
															}
															
															if(nownum == 9 && nownum != Nowpage){
																 str += '<li class="disabled"><span>...</span></li>';  
															}else if(nownum == 9){
																str += '<li class="active"><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+'</a></li> ';  
															}
														
																if(nownum > (page-2)){
																	if(nownum == Nowpage){
																		 str += '<li class="active"><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+' </a></li> ';  
																	 }else{
																		 str += '<li><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+' </a></li> ';  
																	 }
																}
		
														 }
													}else if(Nowpage > 6 && Nowpage < (page-6)){
														for(var i=0;i<page;i++){
															var nownum = i+1;
															var Nowpage = parseInt(Nowpage);
															if(nownum < 3){
																str += '<li><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+' </a></li> '; 
															}
															
															if((nownum > Nowpage-5) && (nownum < Nowpage+5)){
														
																			 if(nownum == (Nowpage-4)){
																					str += '<li class="disabled"><span>...</span></li>';
																			 }   
																			
																				 if(nownum > (Nowpage-4) && nownum < Nowpage){
																					 str += '<li><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+'</a></li>'; 
																				 }  
																			 
																				 if(nownum == Nowpage){
																				 str += '<li class="active"><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+'</a></li>';  
																				 } 
																			 
																				 if(nownum < (Nowpage + 4) && nownum > Nowpage){
																					str += '<li><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+'</a></li>'; 
																				 }  
																		
																				 if(nownum == (Nowpage + 4)){
																				
																				 str += '<li class="disabled"><span>...</span></li>';
																				 }   
															 }
															 
														 if(nownum > (page-2)){
															 var Nowpage = parseInt(Nowpage);
															 if(nownum == Nowpage){
																		 str += '<li class="active"><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+'</a></li>';
																 }else{
																		str += '<li><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+'</a></li> ';
																 }   
														 
																}     
		
														 }
													}else{
														
														for(var i=0;i<page;i++){
															var nownum = i+1;
															if(nownum<3){
																str += '<li><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+' </a></li>';  
															}
														
															if(nownum == (page-10) && nownum != Nowpage){
																str += '<li class="disabled"><span>...</span></li>';   
															}else if(nownum == (page-10) && nownum == Nowpage){
																str += '<li class="active"><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+'</a></li>';   
															}
															
															if(nownum > (page-10)){
																if(nownum == Nowpage){
																	str += '<li class="active"><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+'</a></li> ';   
																}else{
																	str += '<li ><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+'</a></li>';   
																}
															}
															
															
														}
											 
															
													}
												}else{
													 for(var i=0;i<page;i++){
														 var nownum = i+1;
														 if(nownum == Nowpage){
															 str += '<li class="active"><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+' </a></li> ';  
														 }else{
															 str += '<li><a href="javascript:void(0);" onclick="getKnowledgeList('+nownum+');">'+nownum+' </a></li> ';  
														 }
													 }
												}
												
							
										 
												if(Nowpage == page){
													str += '<li id="prevbtn" class="disabled"><span>»</span></li> ';
												}else{
													str += '<li><a href="javascript:void(0);" onclick="getKnowledgeList('+nextpage+');"><span>»</span></a></li>';
												}
											
												str += '</ul>'
												+'</div>'
												+'</div>'
											 
												$("#knowledgepage").find("div").remove();
												$("#knowledgepage").append(str); 
												
											 } 
											 else{
												 
													$("#knowledgepage").find("div").remove();
		
													$("#knowledgelist").find("tr").remove();
												// 	alert('没有数据。');
											 }
											 
								},
								error : function() {
									//alert('获取页面列表失败。');
								}
					});
				
			 			
			 
		 }
		 
		 
	  //去取回默认等级	 
	 function backdefault(sceneId){
		 
		 var url = "{:url('backdefault')}";	
		 $.ajax({
		 				url : url,
		 				dataType : "json", 
		 				type : "post",
		 				data : {'sceneId':sceneId},
		 				success: function(data){
							  //console.log(data);
							
								if (data.code == 0) {
									 // alert(data.msg);
										$('#defaultlevel').text(data.data.level);
										$('#dflevelNum').val(data.data.levelNum);

					
								}else{
									 console.log(data.msg);
	
								}
						},
						error : function() {
							//alert('获取页面列表失败。');
						}
			});
	 }		

	 //删除意向标签
	 
	 function delLabel(id){
		 

		 	var r=confirm('确认删除?');
     	if (!r) 
          return; 
  
		  		var ids = [];
		  		ids.push(id);
		  	//	console.log(id);

		    //	console.log(typeof ids);

		  		if(!ids.length){
		  			alert("至少选择一条。");
		  			return false; 
		  		}
					
				//	console.log(ids);
				//	return false; 
					
		  	$.post("{:url('delLabel')}",{'id':ids},function(data){
		  			if(data){
		  				alert(data);
		  			}else{
		  				getLabelList(1);
		  			}
		  	}); 
	 }
	 

	 function submitAuditing(id){
		 var url = "{:url('setAuditing')}";	
			 $.ajax({
							url : url,
							dataType : "json", 
							type : "post",
							data : {'id':id},
							success: function(data){
								if (data.code) {
							 alert(data.msg);
						}else{
							 location.reload();
						}
							},
							error : function() {
								alert('失败。');
							}
				});
	 
	 }
	 
		//获取话术场景
		function getscenarios(obj,id){
			
			$(obj).addClass("active");
	    $(obj).siblings(".active").removeClass("active");
			
			$("#nowsceneID").val(id);
      
			// $("#dflearn").css({ 'color': "#fffff", 'background-color': "#03a9f4" });	 
			$("#dflearn").removeClass("btn-default");	 
			$("#dflearn").addClass("btn-primary");	 
			$("#dflearn").siblings(".btn").addClass("btn-default");
      searchdata(1,""); //获取学习的数据
			getLabelList(1); //获取意向标签	 
			getNoteList();//获取话术节点
		
			getKnowledgeList(1); //获取知识列表
	   

		} 
		
		//获取学习列表
		function getLearning(obj){
			
			var val = $(obj).attr("data-type");
			
			$(obj).removeClass("btn-default");	 
	  	$(obj).addClass("btn-primary");	 
			$(obj).siblings(".btn").addClass("btn-default");
			
			page = 1;
			searchdata(page,val);
		
			
		}	
		
		//获取学习列表
		var page = 1;
		function searchdata(page,type){	
	 
			var sceneId = $("#nowsceneID").val();
		
			var url = "{:url('learning')}";	
			$.ajax({
							url : url,
							dataType : "json", 
							type : "post",
							data : {'page':page,'sceneId':sceneId,'type':type},
						
							success: function(data){
								
								console.log(data);
		
								var total = data.data.total;
								var Nowpage = data.data.Nowpage;
								var page = data.data.page;
								var Nowpage = parseInt(Nowpage);
								
								var data = data.data.list;
								 if(data.length > 0){

											$("#tablelearninglist").find("tr").remove();
											
											for(var i=0;i<data.length;i++){
												
											
												var id = data[i].id;
												var uid = data[i].member_id;
												var phone = data[i].phone;
												var call_id = data[i].call_id;
												var content = data[i].content;
												var create_time = data[i].create_time;
												var status = data[i].status;

												var strstatus = "待学习";
												if(status == "1"){
														strstatus = "已学习";
												}else if(status == "2"){
														strstatus = "忽略";
												}
	

												var string = '<tr class="itemId'+id+'" alt="'+id+'">'
												  +'<td class="text-center">'+content+'</td>'   
													+'<td class="text-center">'+phone+'</td>'
												
													+'<td class="text-center">'+strstatus+'</td>'
													+'<td class="text-center">'+create_time+'</td>'
													+'<td class="text-center">';
													string += '<a href="javascript:void(0);" onclick="gotoDetail('+uid+');">通话记录</a>&nbsp;&nbsp;'
	
													string += '<a href="javascript:void(0);" onclick="changeStatus('+id+',1);">学习</a>&nbsp;&nbsp;'
													+'<a href="javascript:void(0);" onclick="changeStatus('+id+',2);">忽略</a>&nbsp;&nbsp;'
													+'<a href="javascript:void(0);" onclick="del('+id+');">删除</a>'

													+'</td>';
												 
											
											 string += '</tr>';
											 
												$("#tablelearninglist").append(string); 
	
											}
											
											var prepage = Nowpage-1;
											var nextpage = Nowpage+1;
										 
											var str = '<div class="row">'
											+'<div class="col-sm-3 text-left">'
														
											+'<table class="table table-bordered table-hover" style="margin-bottom: 0px; ">'
											+'<tbody><tr>'
											+'<td class="text-center">总数：'
											+'</td>'
											+'<td class="text-center">'+total+'&nbsp;'
											+'</td>'
																	 
											+'</tr> '
											+'</tbody></table>'                                     
				
											+'</div>'
											+'<div class="col-sm-9 text-right">'
											+'<ul class="pagination">';
										 
											if(Nowpage == 1){
												str += '<li id="prevbtn" class="disabled"><span>«</span></li> ';
											}else{
												str += '<li><a href="javascript:void(0);" onclick="searchdata('+prepage+','+type+');"><span>«</span></a></li> ';
											}
											
											if(page > 10){
											
												if(Nowpage < 7){
													for(var i=0;i<page;i++){
														var nownum = i+1;
														if(nownum < 9){
															 if(nownum == Nowpage){
																 str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+' </a></li> ';  
															 }else{
																 str += '<li><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+' </a></li> ';  
															 }
														}
														
														if(nownum == 9 && nownum != Nowpage){
															 str += '<li class="disabled"><span>...</span></li>';  
														}else if(nownum == 9){
															str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+'</a></li> ';  
														}
													
																	if(nownum > (page-2)){
																		if(nownum == Nowpage){
																 str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+' </a></li> ';  
															 }else{
																 str += '<li><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+' </a></li> ';  
															 }
																	}
	
													 }
												}else if(Nowpage > 6 && Nowpage < (page-6)){
													for(var i=0;i<page;i++){
														var nownum = i+1;
														var Nowpage = parseInt(Nowpage);
														if(nownum < 3){
															str += '<li><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+' </a></li> '; 
														}
														
														if((nownum > Nowpage-5) && (nownum < Nowpage+5)){
													
																		 if(nownum == (Nowpage-4)){
																				str += '<li class="disabled"><span>...</span></li>';
																		 }   
																		
																			 if(nownum > (Nowpage-4) && nownum < Nowpage){
																				 str += '<li><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+'</a></li>'; 
																			 }  
																		 
																			 if(nownum == Nowpage){
																			 str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+'</a></li>';  
																			 } 
																		 
																			 if(nownum < (Nowpage + 4) && nownum > Nowpage){
																				str += '<li><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+'</a></li>'; 
																			 }  
																	
																			 if(nownum == (Nowpage + 4)){
																			
																			 str += '<li class="disabled"><span>...</span></li>';
																			 }   
														 }
														 
													 if(nownum > (page-2)){
														 var Nowpage = parseInt(Nowpage);
														 if(nownum == Nowpage){
																	 str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+'</a></li>';
															 }else{
																	str += '<li><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+'</a></li> ';
															 }   
													 
															}     
	
													 }
												}else{
													
													for(var i=0;i<page;i++){
														var nownum = i+1;
														if(nownum<3){
															str += '<li><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+' </a></li>';  
														}
													
														if(nownum == (page-10) && nownum != Nowpage){
															str += '<li class="disabled"><span>...</span></li>';   
														}else if(nownum == (page-10) && nownum == Nowpage){
															str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+'</a></li>';   
														}
														
														if(nownum > (page-10)){
															if(nownum == Nowpage){
																str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+'</a></li> ';   
															}else{
																str += '<li ><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+'</a></li>';   
															}
														}
														
														
													}
										 
														
												}
											}else{
												 for(var i=0;i<page;i++){
													 var nownum = i+1;
													 if(nownum == Nowpage){
														 str += '<li class="active"><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+' </a></li> ';  
													 }else{
														 str += '<li><a href="javascript:void(0);" onclick="searchdata('+nownum+','+type+');">'+nownum+' </a></li> ';  
													 }
												 }
											}
											
						
									 
											if(Nowpage == page){
												str += '<li id="prevbtn" class="disabled"><span>»</span></li> ';
											}else{
												str += '<li><a href="javascript:void(0);" onclick="searchdata('+nextpage+','+type+');"><span>»</span></a></li>';
											}
										
											str += '</ul>'
											+'</div>'
											+'</div>'
										 
											$("#modalbody").find("div").remove();
											$("#modalbody").append(str); 
											
										 } else{
											 
												$("#modalbody").find("div").remove();

												$("#tablelearninglist").find("tr").remove();
											// 	alert('没有数据。');
										 }
							},
							error : function() {
								//alert('获取页面列表失败。');
							}
				});
			 
	 }
   
	 //改变学习状态
	 function changeStatus(id,status){
	 	
	 		var ids;
	 		if(id){
	 			var Ids=[];
	 			Ids.push(id);
	 			ids = Ids;
	 		}else{
	 				var IdsVal = [];
	 					var roleids = document.getElementsByName("adminids");
	 				for ( var j = 0; j < roleids.length; j++) {
	 					if (roleids.item(j).checked == true) {
	 						IdsVal.push(roleids.item(j).value);
	 					}
	 				}
	 				ids = IdsVal;
	 		}
	 	
	 		if(!ids.length){
	 		alert("至少选择一条。");
	 			return false; 
	 	}
	 		
	 		var url = "{:url('changeStatus')}";	
	 		$.ajax({
	 					url : url,
	 					dataType : "json", 
	 					type : "post",
	 					data : {'Ids':ids,'status':status},
	 					success: function(data){
	 						if (data.code) {
	 								alert(data.msg);
	 						}else{
	 							searchdata(page,0);
	 						}
	 					},
	 					error : function() {
	 						alert('修改失败。');
	 					}
	 		});
	 	
	 	
	 }	
	 	
	 //删除学习
	 function del(id){
	 
	 	var r=confirm('确认删除?');
	 			if (!r) 
	 					return; 
	 
	 			var ids=[];
	 			if(id){
	 				ids.push(id);
	 			}else{
	 				
	 				var roleids = document.getElementsByName("customerIds");
	 				for ( var j = 0; j < roleids.length; j++) {
	 						if (roleids.item(j).checked == true) {
	 							ids.push(roleids.item(j).value);
	 						}
	 				}
	 			}
	 		
	 			if(!ids.length){
	 				alert("至少选择一条。");
	 				return false; 
	 			}
	 		$.post("{:url('delLearning')}",{'id':ids},function(data){
	 				if(data){
	 					alert(data);
	 				}else{
	 					searchdata(page,0);
	 				}
	 		}); 
	 }
	 	
    //删除
    function delScenarios(id){
    
    	 var r=confirm('如果删除，连流程表里面的数据也会删除，确认删除?');
        	if (!r) 
              return; 
   
        	 var ids=[];
       	if(id){
       		ids.push(id);
       	}else{
       		
           	 var roleids = document.getElementsByName("customerIds");
       		 for ( var j = 0; j < roleids.length; j++) {
       		    if (roleids.item(j).checked == true) {
       		    	ids.push(roleids.item(j).value);
       		    }
       		 }
       	}
   		
       	if(!ids.length){
       		alert("至少选择一条。");
       		 return false; 
       	}
     		 $.post("{:url('delScenarios')}",{'id':ids},function(data){
						if(data){
							alert(data);
						}else{
							window.location.href=window.location.href;
						}
   	     }); 
    }
   
	  // 恢复默认配置
	  function recovery(){
			
			var r=confirm('是否确定恢复默认配置?');
				if (!r) 
						return; 
						
		   var sceneId = $("#nowsceneID").val();
		 
			 $.post("{:url('recovery')}",{'sceneId':sceneId},function(data){
				if(data){
					if (data.code) {
							alert(data.msg);
					}else{
						getLabelList(0);
					}
				}else{
					window.location.href=window.location.href;
				}
			 }); 
	
	  }
	  

  /////////////////////////////////
	//note列表
	
	function getNoteList(){
		
		 var sceneId = $("#nowsceneID").val();
		 var href = "{:url('user/Scenarios/getNoteList')}";
		 				
		 				 
		 $.ajax({
				 type: "POST",
				 dataType:'json',
				 url: href,
				 cache: false,
				 data: {"sceneId":sceneId},
				 success: function(data) {
					 
					 // console.log(data);
						$(".flowlist").find("div").remove();
						$("#nowProcessId").val("");
									
						if (data.code == 0) {
							
								var data = data.data;
								if(data.length > 0){
                     
										for(var i=0;i<data.length;i++){
											
											   if(i==0){
													 
													 $("#nowProcessId").val(data[i].id);

													 var string = '<div class="talk-list-item active" dataId="'+data[i].id+'" onclick="getflow(this);">';
												 }else{
													 var string = '<div class="talk-list-item" dataId="'+data[i].id+'" onclick="getflow(this);">';
												 }
												
																string += '<div class="control-icon">'
																+'<span class="anticon glyphicon glyphicon-edit" onclick="newflowModal('+data[i].id+');" aria-hidden="true"></span>'
																+'<span class="anticon glyphicon glyphicon-trash" onclick="delflowNote('+data[i].id+');" aria-hidden="true"></span>'
																+'</div>'
																+'<div class="talklist-item-content"><div>'+data[i].name+'</div></div>'
															+'</div>';
												
											 
												 $(".flowlist").append(string); 
												 
											
										}
								}		
								
						
						}else{
							
							 console.log(data.msg);
							 //alert(data.msg);

						}
				
				 },
				 error: function(data) {
					 alert("提交失败");
				 }
		 }) 
							
							
		
	}
	
	//删除学习
	function delflowNote(id){
	
	var r=confirm('确认删除?');
			if (!r) 
					return; 
	
		$.post("{:url('delflowNote')}",{'id':id},function(data){
				if(data){
					alert(data);
				}else{
					getNoteList();
				}
		}); 
	}
	
	

 </script>
  
</div>



	<style type="text/css">
		.mybtn{
			position:fixed; 
			right:10px; 
			bottom:20px; 
			display:block; 
			width:50px; 
			height:50px;
			border-radius:50px; 
			padding:0px; 
			text-align:center; 
			line-height:50px;
		}
		
		.modal.left .modal-dialog,
		.modal.right .modal-dialog {
			position: fixed;
			margin: auto;
			/* width: 320px; */
			height: 100%;
			-webkit-transform: translate3d(0%, 0, 0);
				-ms-transform: translate3d(0%, 0, 0);
				 -o-transform: translate3d(0%, 0, 0);
					transform: translate3d(0%, 0, 0);
		}
	
		.modal.left .modal-content,
		.modal.right .modal-content {
			height: 100%;
			overflow-y: auto;
		}
		
		.modal.left .modal-body,
		.modal.right .modal-body {
			padding: 15px 15px 80px;
		}
	
		/*Left*/
		.modal.left.fade .modal-dialog{
			left: -320px;
			-webkit-transition: opacity 0.3s linear, left 0.3s ease-out;
				 -moz-transition: opacity 0.3s linear, left 0.3s ease-out;
				 -o-transition: opacity 0.3s linear, left 0.3s ease-out;
					transition: opacity 0.3s linear, left 0.3s ease-out;
		}
		
		.modal.left.fade.in .modal-dialog{
			left: 0;
		}
			
		/*Right*/
		.modal.right.fade .modal-dialog {
			right: -320px;
			-webkit-transition: opacity 0.3s linear, right 0.3s ease-out;
				 -moz-transition: opacity 0.3s linear, right 0.3s ease-out;
				 -o-transition: opacity 0.3s linear, right 0.3s ease-out;
					transition: opacity 0.3s linear, right 0.3s ease-out;
		}
		
		.modal.right.fade.in .modal-dialog {
			right: 0;
		}
	
		/* ----- MODAL STYLE ----- */
		.modal-content {
			border-radius: 0;
			border: none;
		}
	
		.modal-header {
			border-bottom-color: #EEEEEE;
			background-color: #FAFAFA;
		}
		.text-right{
					text-align: right;
		}
		.mgb10{
			margin-bottom: 10px;
			overflow: hidden;
		}
	</style>
	
	 <!-- 知识库 添加录音的 -->
	<div class="modal right fade" id="ThinkTankSound" tabindex="1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
	  
		<div class="modal-dialog">
			
			<div class="modal-content">
			
				 <div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							 <span aria-hidden="true">×</span>
						</button>
						<h4 class="modal-title">添加(编辑)话术流程</h4>
				 </div>
				
				 <div class="modal-body">
					 
			
						  <div class="form-group mgb10">
								<label class="col-lg-3 text-right">标题：</label>
								<div class="col-lg-9 col-sm-9">
									<input id="Soundname" class="form-control ttfw" placeholder="请输入节点名称" type="text" />
								</div>
							</div>
							
							<div class="form-group mgb10">
								<label class="col-lg-3 text-right">关键字：</label>
								<div class="col-lg-9 col-sm-9">
									<textarea id="Soundkeyword" class="form-control" style="width: 250px;height:auto;resize: vertical;"></textarea>
								</div>
							</div>
							
							<div id="soundlist">
									
								<form method="post" action="" class="form-horizontal margintop" enctype="multipart/form-data">	
								  <div class="form-group mgb10">
								  	<label class="col-lg-3 text-right">问题回复：</label>
								  	<div class="col-lg-9 col-sm-9">
								  	  <div class="word">好的，那我稍后让我们资深客户经理联系您，我这边就先不打扰您了，祝您生活愉快，再见！</div>
											
													<div>
														<audio src="http://yy.a5188.cc//uploads/audio/20180825/upload-20180803104040_967.wav" preload="preload" controls="controls"></audio>
													</div>
													
													<div>
														<input type="file" accept="image/jpeg" />
													</div>
												
										
										
								  	</div>
								  </div>
								
								</form>
								
								<form method="post" action="" class="form-horizontal margintop" enctype="multipart/form-data">	
									<div class="form-group mgb10">
										<label class="col-lg-3 text-right">问题回复：</label>
										<div class="col-lg-9 col-sm-9">
											<div class="word">好的，那我稍后让我们资深客户经理联系您，我这边就先不打扰您了，祝您生活愉快，再见！</div>
											
												  <div>
												  	<audio src="http://yy.a5188.cc//uploads/audio/20180825/upload-20180803104040_967.wav" preload="preload" controls="controls"></audio>
												  </div>
													
													<div>
														<input type="file" accept="image/jpeg" />
													</div>
										
										</div>
									</div>
								
								</form>
								
							</div>
				
						
				 </div>
				 <div style="clear:both"></div>

				
		 </div>
						 
		</div>
	 
			<script type="text/javascript">
				
						
				function showSound(){

					$('#ThinkTankSound').modal('show');

				}
							 
			
			</script>
			
	 
	</div>


	 <!-- 添加或者编辑知识库 -->
	<div class="modal fade" id="ThinkTank" tabindex="1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
	  
		<div class="modal-dialog">
			
			<div class="modal-content">
				
					<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								 <span aria-hidden="true">×</span>
							</button>
							<h4 class="modal-title">添加(编辑)知识记录</h4>
					</div>
					
				 <div class="modal-body">
					 
							
						<form id="ThinkTankForm" method="post" class="form-horizontal margintop" enctype="multipart/form-data">	
						
						  <div class="form-group">
								<label class="col-lg-4 control-label">节点名称：</label>
								<div class="col-lg-8 col-sm-8">
									<input id="ttfname" class="form-control ttfw" placeholder="请输入节点名称" type="text" />
								</div>
							</div>
							
							<div class="form-group">
								<label class="col-lg-4 control-label">流程标签：</label>
								<div class="col-lg-8 col-sm-8">
									<input id="flowLabel" class="form-control ttfw" placeholder="请输入流程标签名称" type="text" />
								</div>
							</div>
					
						  <div class="form-group">
								<label class="col-lg-4 control-label">关键字：</label>
								<div class="col-lg-8 col-sm-8">
									<textarea id="keyword" class="form-control" placeholder="多个关键字之间用英文逗号“,”分隔" style="width: 250px;height:auto;resize: vertical;"></textarea>
									<div class="help-block">多个关键字之间用英文逗号“,”分隔</div>
								</div>
							</div>
							
							<div class="form-group">
								<label class="col-lg-4 control-label">机器人文字：</label>
								<div class="col-lg-8 col-sm-8">
									
										<div style="margin-top: 10px;">
											 <button type="button" class="btn btn-primary" onclick="addcontent();" style="font-size: 14px;">
												 <i class="fa fa-plus-circle fa-lg"></i>
												 <span>添加条件</span>
											 </button>
										</div>
										
										<div id="contentlist">
											
										
									  </div>
									
								</div>
							</div>
					

							<div class="form-group" id="breakContent" style="display: block;">
								<label class="col-lg-4 control-label">是否支持自动打断：</label>
								<div class="col-lg-8 col-sm-8">
									<input type="checkbox" id="fnbreak" name="fnbreak" value="1" />
								
								</div>
							</div>
							
							<div class="form-group">
								<label class="col-lg-4 control-label">动作：</label>
								<div class="col-lg-8 col-sm-8">
									<select class="form-control ttfw" id="action" name="action">
										<option value="0">挂机</option>
										<option value="1">下一场景节点</option>
										<option value="2">指定场景节点</option>
										<option value="3">返回当前场景节点中的话术</option>
										<option value="4">等待用户响应</option>
										<option value="5">指定场景节点</option>
									</select>
								</div>
							</div>
					
							
							<div class="form-group">
								<label class="col-lg-4 control-label">意向等级：</label>
								<div class="col-lg-8 col-sm-8">
									<select class="form-control ttfw" id="flowNodeLevel" name="flowNodeLevel">
										<option value=" " selected=""> 选择意向等级 </option>
										<option value="6">A级(有明确意向)</option>
										<option value="5">B级(可能有意向)</option>
										<option value="4">C级(明确拒绝)</option>
										<option value="3">D级(用户忙)</option>
										<option value="2">E级(拨打失败)</option>
										<option value="1">F级(无效客户)</option>
									</select>
								</div>
							</div>
	
					 </form>
						
				 </div>
				 <div style="clear:both"></div>
				 
				 <div class="modal-footer" style="text-align: center;">
					  <input type="hidden" name="ThinkTankId" id="ThinkTankId" value="">
						<button class="btn btn-success submit-btn" onclick="cfThinkTank();" type="button">确 定</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				 </div>
				
		 </div>
						 
		</div>
	 
			<script type="text/javascript">
					
				function showThink(id){

					 if(id){
						 
						  $("#ThinkTankId").val(id);

							var url = "{:url('user/Scenarios/getKnowledgeInfo')}";	
							$.ajax({
									url : url,
									dataType : "json", 
									type : "post",
									data : {'id':id},
									success: function(data){	
										
										var data = data.data;

										$("#ttfname").val(data.name);
										$("#flowLabel").val(data.flow_label);
										$("#keyword").val(data.keyword);
										$('#contentlist').find("div").remove();
										
										var content = data.content;
                    var leng = content.length;
										for(var i=0;i<leng;i++){
											 	var str = '<div class="answer-input-item">'
											 						+'<textarea rows="4" dataId="'+content[i]["id"]+'" placeholder="输入该问题的标准答案，后续坐席或AI答复时将直接调取该答案" maxlength="500" class="form-control ktextarea" >'+content[i]["content"]+'</textarea>'
											 						+'<span class="icon-plus" onclick="delContent(this);">'
											 						+'<span class="anticon glyphicon glyphicon-trash icon-delete" aria-hidden="true"></span>'
											 						+'</span>'
											 						+'</div><div style="clear:both;"></div>';
											 						
											 $('#contentlist').append(str);
										}

										if(data.break == "1"){
											$("#fnbreak").prop("checked",true);
										}
										
										$("#action").val(data.action);
										$("#flowNodeLevel").val(data.intention);
										
										//'console.log(data);
										
										$('#ThinkTank').modal('show');


									},
									error : function() {
										alert('审核信息失败。');
									}
								});
						
					 }
					 else{
						 
						    $("#ttfname").val("");
								$("#flowLabel").val("");
						    $("#fnbreak").prop("checked",false);
						    $("#action").val("0");
						    $("#keyword").val("");
								
								$("#flowNodeLevel").val(" ");
								$("#ThinkTankId").val(""); 
								$('#contentlist').find("div").remove();

						   	$('#ThinkTank').modal('show');

					 }
					 

				}
			 
			 //检查表单的必填项
				function cfThinkTank(){
							 
					var sceneId = $("#nowsceneID").val();
					var processId = $("#nowProcessId").val();

					var name = $("#ttfname").val();
					var flowLabel = $("#flowLabel").val();
					var fnbreak = $("#fnbreak:checked").val();
					var action = $("#action").val();
					var keyword = $("#keyword").val();
				
					var flowNodeLevel = $("#flowNodeLevel").val();
					var ThinkTankId = $("#ThinkTankId").val();
					
					 var itemList = $("#contentlist").find(".ktextarea");
					 
					var content = [];
					$.each(itemList , function(i, n){
						 var temp = $(n).val();
						 
						 var item = {};
						 item.id = $(n).attr("dataId");
						 item.con = temp;
						 
						 content.push(item);
					});

				  //	return false;
					
					var url = "{:url('user/Scenarios/addThinkTank')}";	
						 $.ajax({
										url : url,
										type : "post",
										data : {
											'sceneId':sceneId,
											'processId':processId,
											'name':name,
											'flowLabel':flowLabel,
											'fnbreak':fnbreak,
											'action':action,
											'keyword':keyword,
											'flowNodeLevel':flowNodeLevel,
											'ThinkTankId':ThinkTankId,
											'content':content,
											"delArr":delArr,
										},
										success: function(data){	
											
                        content.splice(0,content.length);
                        delArr.splice(0,delArr.length);
												
											if (data.code == 0) {
												
												$('#ThinkTank').modal('hide');
												getKnowledgeList(1);
													
											}else{
													console.log(data.msg);

											}
											
										//	console.log(data);
										
										},
										error : function() {
											alert(data);
										}
							});
					

					 
				}

       // 添加元素
       function addcontent(){
				 
          var str = '<div class="answer-input-item">'
									  +'<textarea rows="4" dataId="" placeholder="输入该问题的标准答案，后续坐席或AI答复时将直接调取该答案" maxlength="500" class="form-control ktextarea" ></textarea>'
										+'<span class="icon-plus" onclick="delContent(this);">'
										+'<span class="anticon glyphicon glyphicon-trash icon-delete" aria-hidden="true"></span>'
										+'</span>'
										+'</div><div style="clear:both;"></div>';
										
				$('#contentlist').append(str);

								
			 }
			 
			 //删除元素
			 var delArr = [];
			 function delContent(obj){
				 
				 $(obj).parent().remove();
				 
				 var dataid =  $(obj).siblings(".ktextarea").attr("dataid");
				 if(dataid > 0){
					 
					 delArr.push(dataid);

				 }

			 }
			
			</script>
			
	 
	</div>



 <!--  新增  -->
 
{include file="scenarios/speechcraft" /} 


	 <!-- 审核 -->
	<div class="modal fade" id="myLargepage" tabindex="1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
	  
		  <div class="modal-dialog">
				
				<div class="modal-content">
					
						<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									 <span aria-hidden="true">×</span>
								</button>
								<h4 class="modal-title">话术审核</h4>
					  </div>
						
					 <div class="modal-body pagelists">
						 
								
							<form id="form" method="post" class="form-horizontal margintop" enctype="multipart/form-data" >	
						
						  <div class="form-group" id="breakContent" style="display: block;">
									<label class="col-lg-4 control-label">备注：</label>
									<div class="col-lg-8 col-sm-8">
								   	<textarea id="remarks" style="width: 250px;height:auto">null</textarea>

									</div>
								</div>
						 
								
									<div class="form-group" style="text-align: center;">
											<input type="hidden" name="scenariosId" id="scenariosId" value="">
											<button class="btn btn-success submit-btn" onclick="auditing(0);" type="button">通 过</button>
											<button class="btn btn-success submit-btn" onclick="auditing(3);" type="button">不通过</button>

											<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
								 </div>
				
					
						 </form>
						 
							
					 </div>
					 <div style="clear:both"></div>
					
			 </div>
							 
	    </div>
	 
			<script type="text/javascript">
					
				function showExamine(id){

					
						$("#scenariosId").val(id);
					

						var url = "{:url('user/Scenarios/getmessage')}";	
						$.ajax({
								url : url,
								dataType : "json", 
								type : "post",
								data : {'id':id},
								success: function(data){	
									
										$("#remarks").val(data.remark);
									
										$('#myLargepage').modal('show');

								},
								error : function() {
									alert('审核信息失败。');
								}
							});
					

	 
				}
			 
			 
			 //检查表单的必填项
				function auditing(status){
					
		
					var scenariosId = $("#scenariosId").val();
					var remarks = $("#remarks").val();


					var url = "{:url('user/Scenarios/auditing')}";	
						 $.ajax({
										url : url,
										type : "post",
										data : {'scenariosId':scenariosId,'remarks':remarks,'status':status},
										success: function(data){	
											
											$('#myLargepage').modal('hide');

											if(data){
												alert(data);
											}else{
												location.reload();
											}
										
										},
										error : function() {
											alert(data);
										}
							});
					

					 
				}


			
			</script>
			
	   
	  </div>
	

<!--  通话详情  -->
{include file="scenarios/callDetails" /} 

 <!--  新建规则  -->
{include file="scenarios/newRule" /} 

 <!--  编辑默认等级  -->
 
 {include file="scenarios/dfleve" /} 
 
 
 <!-- 新建节点 -->
 <div class="modal fade" id="flownode" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
   
 	  <div class="modal-dialog modal-sm" style="width: 360px;">
 			
 			<div class="modal-content">
 					<div class="modal-header">
 							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
 								 <span aria-hidden="true">×</span>
 							</button>
 							<h4 class="modal-title">添加(编辑)话术流程</h4>
 				 </div>
 				 <div class="modal-body pagelists">
 					 
 							
 						<form id="flownoteform" method="post" class="form-horizontal margintop" enctype="multipart/form-data" >	
 					
 								<div class="form-group">
 									<label class="col-lg-4 control-label">流程名称：</label>
 									<div class="col-lg-8 col-sm-8">
 										 <input type="text" class="form-control textwidth" placeholder="请输入物流名称" name="flowname" id="flowname" />
 									</div>
 								</div>
 					
 								<div class="form-group" style="text-align: center;">
 										<input type="hidden" name="flowId" id="flowId" value="">
 										<button class="btn btn-success submit-btn" onclick="formFlow();" type="button">确 定</button>
 										<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
 							 </div>
 			
 				
 					 </form>
 					 
 						
 				 </div>
 				 <div style="clear:both"></div>
 				
 		 </div>
 						 
     </div>
  
 		<script type="text/javascript">
 				
 			function newflowModal(id){
 				 
 				 if(id){
 							var url = "{:url('user/Scenarios/getFlowInfo')}";	
 						 $.ajax({
 								url : url,
 								dataType : "json", 
 								type : "post",
 								data : {'id':id},
 								success: function(data){	
											if (data.code == 0) {
												
												$("#flowname").val(data.data.name);
												$("#flowId").val(data.data.id);
												
											}else{
													alert(data.msg);
					
											}
 									
 										
 										 $('#flownode').modal('show');
 								},
 								error : function() {
 									alert('获取信息失败。');
 								}
 							});
 					
 				 }
 				 else{
 					 
 					    $("#flowname").val("");
 
 						  $("#flowId").val("");
 						
 						 $('#flownode').modal('show');
 						 
 				 }
 				
 		 
 			}
 		 
 		 
 		 //检查表单的必填项,提交流程表单
 			function formFlow(){
 
 					var name = $("#flowname").val();
 					if(!name){
 						alert("流程名不能为空"); 
 						return false; 
 					}
 					
 				 var flowId = $("#flowId").val();
				 var sceneId = $("#nowsceneID").val();

 
 				 var href = "{:url('user/Scenarios/addflowNote')}";
 				
 				 
 				 $.ajax({
 						 type: "POST",
 						 dataType:'json',
 						 url: href,
 						 cache: false,
 						 data: {"name":name,"flowId":flowId,"sceneId":sceneId},
 						 success: function(data) {
 							if (data.code == 0) {
 								  
 									$('#flownode').modal('hide');
 							  	getNoteList();
 							}else{
 								 alert(data.msg);
 
 							}
 					
 						 },
 						 error: function(data) {
 							 alert("提交失败");
 						 }
 				 }) 
					
					
					
 			}
 
 
 		
 		</script>
 		
    
 </div>
 
 
 
 
 

{/block}

